<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCT | Executive Dispatch</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --sct-green: #064e3b;
            --sct-emerald: #10b981;
            --sct-gold: #b45309;
            --bg: #f0f2f5;
        }

        body { 
            background: var(--bg); 
            color: #1e293b; 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
        }

        /* Layout Controls */
        .admin-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            max-width: 1500px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Sidebar Styling */
        .control-panel {
            background: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            height: fit-content;
        }

        .input-group { margin-bottom: 20px; }
        label { font-size: 11px; font-weight: 800; color: var(--sct-green); text-transform: uppercase; display: block; margin-bottom: 8px; }
        input { 
            width: 100%; padding: 12px; border: 1.5px solid #e2e8f0; border-radius: 8px; 
            box-sizing: border-box; font-family: 'Poppins'; outline: none;
        }

        /* DOCUMENT STYLING (The Letter) */
        .letter-canvas {
            background: #ffffff;
            width: 210mm; /* A4 Width */
            min-height: 297mm; /* A4 Height */
            margin: 0 auto;
            padding: 80px;
            box-sizing: border-box;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Typography */
        .letter-header-text { 
            font-family: 'Poppins', sans-serif; 
            color: var(--sct-green);
            text-align: center;
        }

        .letter-body-text { 
            font-family: 'Cambria', 'Georgia', serif; 
            font-size: 12pt; 
            line-height: 1.6;
            color: #111;
            text-align: justify;
        }

        h1.main-title { font-size: 14pt; margin: 0; letter-spacing: 1px; }
        h3.subject-line { font-family: 'Poppins'; font-size: 13pt; text-align: center; text-decoration: underline; margin: 40px 0; }

        /* Signature & Seal */
        .signature-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 50px;
            opacity: 0;
            transition: 1s ease-in-out;
        }

        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            padding-bottom: 20px;
        }

        #qrcode { padding: 10px; border: 1px solid #eee; }

        /* Buttons */
        .btn-dispatch {
            background: var(--sct-green);
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .status-banner {
            display: none;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 13px;
        }

        @media print {
            .control-panel, .status-banner { display: none !important; }
            body { background: white; }
            .letter-canvas { box-shadow: none; margin: 0; padding: 50px; }
        }
    </style>
</head>
<body onload="initialize()">

    <div class="admin-layout">
        <aside class="control-panel">
            <h2 style="font-size: 18px; color: var(--sct-green); margin-bottom: 25px;">Dispatch Console</h2>
            
            <div id="msgBox" class="status-banner"></div>

            <div class="input-group">
                <label>Recipient Gmail</label>
                <input type="email" id="email" placeholder="student@gmail.com" oninput="liveSync()">
            </div>
            <div class="input-group">
                <label>Student Name</label>
                <input type="text" id="name" placeholder="Full Name" oninput="liveSync()">
            </div>
            <div class="input-group">
                <label>Matric Number</label>
                <input type="text" id="matric" placeholder="SCT/2026/001" oninput="liveSync()">
            </div>
            <div class="input-group">
                <label>Organization</label>
                <input type="text" id="org" placeholder="Recipient Company" oninput="liveSync()">
            </div>

            <div style="background: #fffbeb; padding: 20px; border-radius: 15px; border: 1px solid #fef3c7;">
                <label>Executive Password</label>
                <input type="password" id="pass" placeholder="••••••••">
                <button class="btn-dispatch" onclick="processAndSend()" id="sendBtn">
                    <i class="ph ph-paper-plane-tilt"></i> AUTHORIZE & SEND
                </button>
            </div>
        </aside>

        <main class="letter-canvas" id="letter">
            
            <header class="letter-header-text">
                <i class="ph-fill ph-seal-check" style="font-size: 50px; color: var(--sct-emerald);"></i>
                <h1 class="main-title" style="margin-top: 10px;">OFFICE OF THE GENERAL SECRETARY</h1>
                <p style="font-size: 10px; letter-spacing: 4px; font-weight: 800; color: var(--sct-gold); margin: 5px 0;">SCHOOL OF COMPUTING TECHNOLOGY</p>
                <div style="height: 2px; background: var(--sct-green); width: 100%; margin-top: 15px;"></div>
            </header>

            <div class="letter-body-text" style="display: flex; justify-content: space-between; margin: 40px 0;">
                <span><strong>REF:</strong> SCT/OGS/26/<span id="vMatShort">000</span></span>
                <span><strong>DATE:</strong> <span id="vDate">23rd January 2026</span></span>
            </div>

            <div class="letter-body-text">
                <p><strong>TO THE DIRECTOR/HEAD OF OPERATIONS,</strong><br><span id="vOrg">[Organization Name]</span></p>
                
                <p>Dear Sir/Madam,</p>

                <h3 class="subject-line">OFFICIAL LETTER OF INTRODUCTION: <span id="vNameCap">[NAME]</span></h3>

                <p>This is to formally introduce <strong><span id="vNameBody">[Student Name]</span></strong> with Matriculation Number <strong><span id="vMatFull">[Matric No]</span></strong>, who is a recognized student of the School of Computing Technology.</p>
                
                <p>The student is currently authorized to engage in professional academic research and industrial interface activities. We verify that the bearer is of good character and academic standing. We kindly request that you accord them the necessary cooperation and professional assistance required for their engagement with your establishment.</p>
                
                <p>Thank you for your anticipated professional partnership.</p>
            </div>

            <div class="signature-section" id="sigBox">
                <div style="text-align: center;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/d/d4/Signature_of_John_Hancock.png" style="width: 140px; filter: grayscale(1);">
                    <div style="width: 180px; height: 1.5px; background: #000; margin: 5px auto;"></div>
                    <p style="font-family: 'Poppins'; font-size: 10px; font-weight: bold;">EXECUTIVE PRESIDENT</p>
                </div>

                <div id="officialSeal" style="width: 120px; height: 120px; border: 4px double var(--sct-emerald); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--sct-emerald); font-weight: 900; font-size: 10px; text-align: center; transform: rotate(-15deg); opacity: 0;">
                    SCT<br>SECRETARIAT<br>OFFICIAL
                </div>

                <div style="text-align: center;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/7/70/Signature_of_George_Washington.png" style="width: 140px; filter: grayscale(1);">
                    <div style="width: 180px; height: 1.5px; background: #000; margin: 5px auto;"></div>
                    <p style="font-family: 'Poppins'; font-size: 10px; font-weight: bold;">GENERAL SECRETARY</p>
                </div>
            </div>

            <div class="qr-container">
                <div id="qrcode"></div>
                <p style="font-size: 8px; margin-top: 10px; color: #888;">SCAN TO VERIFY DOCUMENT INTEGRITY</p>
            </div>

        </main>
    </div>

    <script>
        // Init EmailJS
        (function() { emailjs.init("i29BVm5QIlaBD1wmO"); })();

        function initialize() {
            const now = new Date();
            const day = now.getDate();
            const month = now.toLocaleString('default', { month: 'long' });
            const suffix = (d) => { if (d > 3 && d < 21) return 'th'; switch (d % 10) { case 1: return "st"; case 2: return "nd"; case 3: return "rd"; default: return "th"; } };
            document.getElementById('vDate').innerText = `${day}${suffix(day)} ${month} ${now.getFullYear()}`;
            liveSync();
        }

        function liveSync() {
            const name = document.getElementById('name').value || "[Student Name]";
            const mat = document.getElementById('matric').value || "SCT/26/000";
            document.getElementById('vNameCap').innerText = name.toUpperCase();
            document.getElementById('vNameBody').innerText = name;
            document.getElementById('vMatFull').innerText = mat;
            document.getElementById('vMatShort').innerText = mat.split('/').pop();
            document.getElementById('vOrg').innerText = document.getElementById('org').value || "[Organization Name]";
            
            const qrContainer = document.getElementById("qrcode");
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, { text: "VERIFY:" + mat, width: 80, height: 80 });
        }

        async function processAndSend() {
            const pass = document.getElementById('pass').value;
            const targetEmail = document.getElementById('email').value;

            if(pass !== "dolpgrace01") return alert("Unauthorized Key.");
            if(!targetEmail) return alert("Please provide recipient Gmail.");

            const btn = document.getElementById('sendBtn');
            const msg = document.getElementById('msgBox');

            // Start Effects
            btn.disabled = true;
            btn.innerText = "Processing Authorization...";
            document.getElementById('sigBox').style.opacity = "1";
            document.getElementById('officialSeal').style.opacity = "0.6";

            msg.style.display = "block";
            msg.style.background = "#dcfce7";
            msg.style.color = "#166534";
            msg.innerText = "SEALING & DISPATCHING PDF...";

            try {
                const element = document.getElementById('letter');
                const pdfBase64 = await html2pdf().set({
                    margin: 0,
                    filename: 'SCT_Official_Letter.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                }).from(element).output('datauristring');

                await emailjs.send("service_p0l6s0f", "__ejs-test-mail-service__", {
                    to_email: targetEmail,
                    to_name: document.getElementById('name').value,
                    content_pdf: pdfBase64
                });

                msg.innerText = "SUCCESS! DISPATCHED TO GMAIL.";
                alert("The authorized letter has been sent to " + targetEmail);

            } catch (err) {
                alert("System Error: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "AUTHORIZE & SEND";
            }
        }
    </script>
</body>
</html>